---
title: 事後課題(M1)の説明
date: 2016-10-11
author: 西山
---

# 事後課題

第1回の事後課題は次のようだった。

データファイル"gdpcons-1994-2012.csv"を読み込み、上と同じ回帰分析を行え。但し、このデータファイルの期間は1994年から2012年までであるから、バブル景気の影響を調べるにはあたらない。

## データファイルの読み込みとデータの概要

まずデータを読む。各行のデータがコンマで区切られたCSV形式になっている（多分、エクセルで編集した）ので、read.csvを使って読み込む。

```{r read_data}
data0 <- read.csv(file.choose())
```

ファイル選択画面で指定すればよい。

読み込んだ中身には"data0"という名前をつけているが、これは（もちろん）任意である。西山は、マア最初のデータという意味で習慣的にファイルから読んだ内容には"data0"、"data1"のようにつけているが、ここは各自好きにつけてよい。

ファイルの大きさ、最初の何行かを確認しておく。
```{r head}
dim(data0)
head(data0)
```

個別データのGDPとCONSを折れ線グラフにしておく。横軸にはYEARを使う。
```{r fig}
attach(data0)
plot(YEAR,GDP,type="l",main="GDP")
plot(YEAR,CONS,type="l",main="CONS")
```

データ全体"data0"に含まれる個別データの名前をそのまま使いたいので最初にattachしておく。

図のタイトルはなくともよいが、GDPかCONSかが分からないと不便である。mainでメインタイトルが入るのでつけておこう。

ちなみにplotコマンドで"xlab"を指定すると横軸ラベル、"ylab"を指定すると縦軸ラベルが入る。日本語もOKである --- Macもできるが日本語コードを指定しないといけない。

データの概要を出しておこう。

```{r gaiyou}
summary(data0)
```

## 単回帰分析

消費はGDPの影響を受けると考えられるので
$$
CONS = a + b \times GDP
$$
という回帰直線を散布図に当てはめることにする。

```{r simple_reg}
kekka1 <- lm(CONS ~ GDP, data=data0)
summary(kekka1)
plot(GDP,CONS)
abline(kekka1)
```

回帰分析を済ませたあとで散布図を描き、その上に回帰直線を書き加えている点に注目せよ。

## 重回帰分析（参考）

1997年から1999年は「金融パニック期」であったと想定しよう。その年が金融パニック期に含まれているかいないかで、同じGDPであっても出てくる消費需要には違いがあるかもしれない。この点を確かめよう。

まずその年が金融パニック期に当たっているどうかという新しいデータをつくる。

それにはデータYEARが、1997から1999の間に入っているかどうかをみればよい。

```{r make_panic}
PANIC <- (YEAR >= 1997) & (YEAR <= 1999)
data.frame(nen=YEAR,kubetu=PANIC)
```

作ったデータ"PANIC"は考えているようになっているので、これを元のデータセット"data0"に追加する。

授業でも話したが、data.frameは表をつくるコマンドである。表の列それぞれに対応する個別データ名を指定すれば表にしてくれる。


```{r add_panic}
data0$PANIC <- PANIC
data0
```

**ここはRの基本操作では肝心なところ**。データ全体を「データセット」、その中に含まれている個別データを「データ」と呼ぶことも多いが、<font color="red">**データセット名$データ名**</font>という形式はRでは頻繁に使う。使いこなせれば便利であるし、「Rを使っている」という感覚が芽生えるのもこの辺りである。

新しいデータを追加したら、（念のため）内容を表示して確認しておく。これが上の2行目のコマンド。

さて、今度は重回帰分析をする。推定する式は
$$
CONS = a + b \times GDP + c \times PANIC
$$

```{r mreg}
kekka2 <- lm(CONS ~ GDP + PANIC,data=data0)
summary(kekka2)
```

結果をみると、PANICがTRUEのとき消費は低下するという推定になっている。これは予想通りの結果であるが、しかしこの推定の標準誤差は大きくT値は小さい。『金融パニック期には、それが原因になって消費が抑えられた』と、断言するには（これだけでは）データ的に不十分である。ここまで言える。

この結果を利用した予測の計算は省略する（将来予測にはあまり使わないので）。

ちなみに回帰分析結果をとってプロットしてみると色々なことが分かる。「回帰分析」がうまく行っているかどうかの検証に使うので「回帰診断」と呼んでいるが、これもよほど変な結果が出てこない限り吟味することはないので割愛したい。

```{r diag_reg}
plot(kekka2)
```

## 最後に

さて、この資料では（練習の意味もあって）Rの中でPANICという変数を作ったが、多くの人は元のデータファイルにPANICという列を最初から入れるはずであり、（データが少ない時は）この方がずっと簡単かもしれない --- 但し、データ数が何百万行もあるビッグデータではエクセルで新しい変数をつくるのは無理である。アップしたデータファイル"gdpcons-1994-2012-panic.csv"を開いて確認せられたい。こちらのデータファイルを読んで同じ重回帰分析をした時にどうなるか？これは自由課題ということにしておくのでもし疑問が生じたら質問すること。








